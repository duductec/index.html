<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Pagamentos - Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f2f2f2; }
    input, button { padding: 8px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
    .actions button { margin-right: 5px; }
  </style>
</head>
<body>
  <h2>Sistema de Pagamentos</h2>
  <input type="text" id="numero" placeholder="Número de Série">
  <input type="text" id="nome" placeholder="Nome">
  <input type="number" id="valor" placeholder="Valor a Receber">
  <input type="number" id="juros" placeholder="Juros (%)">
  <button onclick="salvarCliente()">Adicionar Cliente</button>
  <button onclick="exportarCSV()">Exportar CSV</button>

  <table>
    <thead>
      <tr>
        <th>Número de Série</th>
        <th>Nome</th>
        <th>Valor</th>
        <th>Juros (%)</th>
        <th>Valor Total</th>
        <th>Data</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody id="tabela"></tbody>
  </table>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCe_k-LbbLF5yqS-V9Z6cZsx5Fqmp5yl6I",
      authDomain: "teste-html-firebase.firebaseapp.com",
      databaseURL: "https://teste-html-firebase-default-rtdb.firebaseio.com",
      projectId: "teste-html-firebase",
      storageBucket: "teste-html-firebase.appspot.com",
      messagingSenderId: "694978035474",
      appId: "1:694978035474:web:2e5194cb591a19c1c25a3a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function salvarCliente() {
      const numero = document.getElementById('numero').value;
      const nome = document.getElementById('nome').value;
      const valor = parseFloat(document.getElementById('valor').value);
      const juros = parseFloat(document.getElementById('juros').value);
      const data = new Date().toLocaleDateString('pt-BR');

      if (!numero || !nome || isNaN(valor) || isNaN(juros)) {
        alert("Preencha todos os campos corretamente");
        return;
      }

      const valorTotal = (valor * (1 - juros / 100)).toFixed(2);
      const id = Date.now();

      db.ref('pagamentos/' + id).set({ numero, nome, valor, juros, valorTotal, data });
      limparCampos();
    }

    function limparCampos() {
      document.getElementById('numero').value = '';
      document.getElementById('nome').value = '';
      document.getElementById('valor').value = '';
      document.getElementById('juros').value = '';
    }

    function removerCliente(id) {
      if (confirm("Deseja excluir este registro?")) {
        db.ref('pagamentos/' + id).remove();
      }
    }

    function editarCliente(id, dados) {
      document.getElementById('numero').value = dados.numero;
      document.getElementById('nome').value = dados.nome;
      document.getElementById('valor').value = dados.valor;
      document.getElementById('juros').value = dados.juros;
      removerCliente(id);
    }

    function exportarCSV() {
      db.ref('pagamentos').once('value', snapshot => {
        let csv = 'Número de Série,Nome,Valor,Juros (%),Valor Total,Data\n';
        snapshot.forEach(item => {
          const d = item.val();
          csv += `${d.numero},${d.nome},${d.valor},${d.juros},${d.valorTotal},${d.data}\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'dados_pagamentos.csv';
        link.click();
      });
    }

    db.ref('pagamentos').on('value', snapshot => {
      const tabela = document.getElementById('tabela');
      tabela.innerHTML = '';
      snapshot.forEach(item => {
        const dados = item.val();
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${dados.numero}</td>
          <td>${dados.nome}</td>
          <td>R$ ${parseFloat(dados.valor).toFixed(2)}</td>
          <td>${dados.juros}%</td>
          <td>R$ ${dados.valorTotal}</td>
          <td>${dados.data}</td>
          <td class="actions">
            <button onclick='editarCliente("${item.key}", ${JSON.stringify(dados)})'>Editar</button>
            <button onclick='removerCliente("${item.key}")'>Deletar</button>
          </td>`;
        tabela.appendChild(tr);
      });
    });
  </script>
</body>
</html>
